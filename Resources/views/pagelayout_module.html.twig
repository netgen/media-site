{% extends 'NetgenMoreDemoBundle::pagelayout_legacy.html.twig' %}

{% set availableTranslations = [] %}
{% set prioritizedLanguages = ezpublish.configResolver.getParameter( 'languages' ) %}

{% for language in ezpublish.availableLanguages %}
    {% set translationSiteAccess = ezpublish.translationSiteAccess( language ) %}

    {% if translationSiteAccess is not empty %}
        {% if language != prioritizedLanguages.0 %}
            {% set url = url(
                ez_route(
                    'ez_legacy', {
                        'module_uri': app.request.attributes.get( 'semanticPathinfo' ) ~ app.request.attributes.get( 'viewParametersString' ),
                        'siteaccess': translationSiteAccess
                    }
                )
            ) %}

            {# Hack to remove "siteaccess" view parameter from URL generated by ez_legacy route #}
            {% set url = url|replace( { ( '/(siteaccess)/' ~ translationSiteAccess ): '' } ) %}

            {% set availableTranslations = availableTranslations|merge( { ( language ): url } ) %}
        {% else %}
            {% set availableTranslations = availableTranslations|merge( { ( language ): '#' } ) %}
        {% endif %}
    {% endif %}
{% endfor %}

{% block content %}
    {{ module_result.content|raw }}
{% endblock %}
